import{r as s,j as e}from"./app-xcXBagAU.js";const L=()=>{const u=s.useRef(null),h=s.useRef(null),[j,p]=s.useState(null),[x,g]=s.useState(!1),[y,b]=s.useState(!1),[r,v]=s.useState(null),[O,o]=s.useState(!1),[R,i]=s.useState("Loading..."),[d,m]=s.useState(null),[n,C]=s.useState([]),[f,S]=s.useState(0);s.useEffect(()=>{navigator.mediaDevices.enumerateDevices().then(t=>{const a=t.filter(l=>l.kind==="videoinput");console.log(a),C(a)})},[]);const w=async(t=null)=>{b(!0),r&&r.getTracks().forEach(c=>c.stop());const a={video:t?{deviceId:{exact:t}}:!0},l=await navigator.mediaDevices.getUserMedia(a);u.current.srcObject=l,v(l),g(!1),p(null),m(null)},N=()=>{r&&r.getTracks().forEach(t=>t.stop()),b(!1)},D=()=>{h.current.getContext("2d").drawImage(u.current,0,0,640,480),h.current.toBlob(I,"image/jpeg"),g(!0),N()},E=async()=>{d&&(o(!0),i("Deleting ..."),await fetch("/api/delete-photo",{method:"DELETE",headers:{"Content-Type":"application/json",Accept:"application/json"},body:JSON.stringify({path:d})})),p(null),m(null),g(!1),o(!1),w(n[f].deviceId)},k=async()=>{d&&(o(!0),i("Deleting ..."),await fetch("/api/delete-photo",{method:"DELETE",headers:{"Content-Type":"application/json",Accept:"application/json"},body:JSON.stringify({path:d})}),o(!1),window.location.href=route("dashboard"))},P=async t=>{t&&(i("Enrolling ..."),await fetch("/api/enroll-photo",{method:"POST",headers:{"Content-Type":"application/json",Accept:"application/json"},body:JSON.stringify({path:t})}),o(!1))},I=async t=>{const a=new FormData;a.append("photo",t,"webcam.jpg"),o(!0),i("Processing ...");const c=await(await fetch("/api/upload-photo",{method:"POST",body:a,headers:{Accept:"application/json"}})).json();p(c.url),m(c.path),await P(c.path)},T=()=>{const t=(f+1)%n.length;S(t),w(n[t].deviceId)};return e.jsx("div",{children:e.jsxs("div",{className:"fixed inset-0 bg-gray-400 z-50 flex items-center justify-center",children:[!x&&y&&e.jsx("video",{ref:u,autoPlay:!0,playsInline:!0,muted:!0,className:"w-full h-full object-cover"}),e.jsx("canvas",{ref:h,width:"640",height:"480",style:{display:"none"}}),!x&&e.jsx("div",{className:"absolute bottom-6 w-full flex justify-center gap-4 px-4",children:y?e.jsxs("div",{className:"flex gap-4",children:[e.jsx("button",{onClick:D,className:"bg-white text-blue-500 px-6 py-2 rounded shadow-lg text-lg",children:"Capture Photo"}),n.length>1&&e.jsx("button",{onClick:T,className:"bg-gray-700 text-white px-6 py-2 rounded shadow text-lg",children:"Switch Camera"}),e.jsx("a",{href:route("dashboard"),className:"bg-red-600 text-white px-6 py-2 rounded shadow-lg text-lg",children:"Close"})]}):e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:()=>{w(n[f].deviceId)},className:"bg-white text-black px-6 py-2 rounded shadow-lg text-lg",children:"Start Camera"}),e.jsx("a",{href:route("dashboard"),className:"bg-red-600 text-white px-6 py-2 rounded shadow-lg text-lg",children:"Close"})]})}),x&&e.jsxs("div",{className:"min-h-screen bg-gray-900 text-white flex flex-col items-center justify-center px-4 py-6",children:[j&&e.jsx("img",{src:j,alt:"Captured",className:"w-full max-w-md rounded-lg shadow-lg mb-6"}),e.jsxs("div",{className:"flex gap-3 justify-center",children:[e.jsx("button",{onClick:E,className:"bg-red-600 px-6 py-2 rounded shadow text-white text-lg",children:"Retake Photo"}),e.jsx("button",{className:"bg-white px-6 py-2 rounded shadow text-blue-500 text-lg",children:"Enroll"}),e.jsx("button",{onClick:k,className:"bg-red-600 px-6 py-2 rounded shadow text-white text-lg",children:"Close"})]})]})]})})};export{L as default};
