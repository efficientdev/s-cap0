import{r as o,a as n,j as s}from"./app-99MzBzht.js";import O from"./OverlaySpinner-DNAcALNZ.js";n.defaults.headers.common["X-Requested-With"]="XMLHttpRequest";const C=document.head.querySelector('meta[name="csrf-token"]');console.log(C);C?n.defaults.headers.common["X-CSRF-TOKEN"]=C.content:console.error("CSRF token not found");n.defaults.withCredentials=!0;(async()=>await n.get("/sanctum/csrf-cookie"))();const B=()=>{const g=o.useRef(null),m=o.useRef(null),[S,x]=o.useState(null),[y,w]=o.useState(!1),[k,N]=o.useState(!1),[h,R]=o.useState(null),[P,l]=o.useState(!0),[D,p]=o.useState("Loading..."),[U,c]=o.useState(!1),[H,i]=o.useState({}),[K,d]=o.useState(""),[f,j]=o.useState(null),[u,I]=o.useState([]),[b,E]=o.useState(0);o.useEffect(()=>{navigator.mediaDevices.enumerateDevices().then(r=>{const a=r.filter(t=>t.kind==="videoinput");console.log(a),I(a)}),n.defaults.headers.common["X-Requested-With"]="XMLHttpRequest";const e=document.head.querySelector('meta[name="csrf-token"]');console.log(e),e?n.defaults.headers.common["X-CSRF-TOKEN"]=e.content:console.error("CSRF token not found"),n.defaults.withCredentials=!0,(async()=>await n.get("/sanctum/csrf-cookie"))()},[]);const v=async(e=null)=>{N(!0),h&&h.getTracks().forEach(t=>t.stop());const r={video:e?{deviceId:{exact:e}}:!0},a=await navigator.mediaDevices.getUserMedia(r);g.current.srcObject=a,R(a),w(!1),x(null),j(null)},q=()=>{h&&h.getTracks().forEach(e=>e.stop()),N(!1)},F=()=>{m.current.getContext("2d").drawImage(g.current,0,0,640,480),m.current.toBlob(T,"image/jpeg"),w(!0),q()},X=async()=>{if(f){l(!0),p("Deleting ...");try{const e=await n.delete("/api/delete-photo",{path:f},{headers:{Accept:"application/json"}});console.log(e==null?void 0:e.data),d("Photo enrolled successfully!")}catch(e){e.response&&e.response.status===422?i(e.response.data.errors||{}):console.error(e)}finally{c(!1),l(!1)}}x(null),j(null),w(!1),l(!1),v(u[b].deviceId)},A=async()=>{if(f){l(!0),p("Deleting ...");try{const e=await n.delete("/api/delete-photo",{path:f},{headers:{Accept:"application/json"}});console.log(e==null?void 0:e.data),d("Photo deleted successfully!")}catch(e){e.response&&e.response.status===422?i(e.response.data.errors||{}):console.error(e)}finally{c(!1),l(!1)}window.location.href=route("dashboard")}},M=async e=>{var r,a;if(e){p("Enrolling ...");try{const t=await n.post("/api/enroll-photo",{path:e},{headers:{Accept:"application/json"}});console.log(t==null?void 0:t.data),(a=(r=t==null?void 0:t.data)==null?void 0:r.output)!=null&&a.success,d("Photo enrolled successfully!")}catch(t){t.response&&t.response.status===422?i(t.response.data.errors||{}):console.error(t)}finally{c(!1),l(!1)}}},T=async e=>{const r=new FormData;r.append("photo",e,"webcam.jpg"),l(!0),p("Processing ..."),c(!0),i({}),d("");try{const a=await n.post("/api/upload-photo",r,{headers:{"Content-Type":"multipart/form-data",Accept:"application/json"}}),t=a==null?void 0:a.data;x(t.url),j(t.path),console.log(t),await M(t.extpath),d("Photo uploaded successfully!")}catch(a){a.response&&a.response.status===422?i(a.response.data.errors||{}):console.error(a)}finally{c(!1)}},L=()=>{const e=(b+1)%u.length;E(e),v(u[e].deviceId)};return s.jsxs("div",{children:[s.jsx(O,{isVisible:P,message:D}),s.jsxs("div",{className:`${P?"hidden":"fixed"} z-50  inset-0 bg-gray-400 flex items-center justify-center`,children:[!y&&k&&s.jsx("video",{ref:g,autoPlay:!0,playsInline:!0,muted:!0,className:"w-full h-full object-cover"}),s.jsx("canvas",{ref:m,width:"640",height:"480",style:{display:"none"}}),!y&&s.jsx("div",{className:"absolute bottom-6 w-full flex justify-center gap-4 px-4",children:k?s.jsxs("div",{className:"flex gap-4",children:[s.jsx("button",{onClick:F,className:"bg-white text-blue-500 px-6 py-2 rounded shadow-lg text-lg",children:"Capture Photo"}),u.length>1&&s.jsx("button",{onClick:L,className:"bg-gray-700 text-white px-6 py-2 rounded shadow text-lg",children:"Switch Camera"}),s.jsx("a",{href:route("dashboard"),className:"bg-red-600 text-white px-6 py-2 rounded shadow-lg text-lg",children:"Close"})]}):s.jsxs(s.Fragment,{children:[s.jsx("button",{onClick:()=>{v(u[b].deviceId)},className:"bg-white text-black px-6 py-2 rounded shadow-lg text-lg",children:"Start Camera"}),s.jsx("a",{href:route("dashboard"),className:"bg-red-600 text-white px-6 py-2 rounded shadow-lg text-lg",children:"Close"})]})}),y&&s.jsxs("div",{className:"min-h-screen bg-gray-900 text-white flex flex-col items-center justify-center px-4 py-6",children:[S&&s.jsx("img",{src:S,alt:"Captured",className:"w-full max-w-md rounded-lg shadow-lg mb-6"}),s.jsxs("div",{className:"flex gap-3 justify-center",children:[s.jsx("button",{onClick:X,className:"bg-red-600 px-6 py-2 rounded shadow text-white text-lg",children:"Retake Photo"}),s.jsx("button",{className:"bg-white px-6 py-2 rounded shadow text-blue-500 text-lg",children:"Enroll"}),s.jsx("button",{onClick:A,className:"bg-red-600 px-6 py-2 rounded shadow text-white text-lg",children:"Close"})]})]})]})]})};export{B as default};
