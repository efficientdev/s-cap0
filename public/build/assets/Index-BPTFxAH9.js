import{r as o,a as c,j as s}from"./app-C4yp8xsr.js";import W from"./OverlaySpinner-DLWV3Hma.js";c.defaults.headers.common["X-Requested-With"]="XMLHttpRequest";const k=document.head.querySelector('meta[name="csrf-token"]');c.defaults.withCredentials=!0;console.log(k);k?(c.defaults.headers.common["X-CSRF-TOKEN"]=k.content,(async()=>await c.get("/sanctum/csrf-cookie"))()):console.error("CSRF token not found");const _=()=>{const x=o.useRef(null),y=o.useRef(null),[N,w]=o.useState(null),[j,v]=o.useState(!1),[P,D]=o.useState(!1),[g,A]=o.useState(null),[I,r]=o.useState(!1),[U,u]=o.useState("Loading..."),[G,i]=o.useState(!1),[J,h]=o.useState({}),[Q,f]=o.useState(""),[m,R]=o.useState(null),[p,q]=o.useState([]),[b,L]=o.useState(0);o.useEffect(()=>{navigator.mediaDevices.enumerateDevices().then(e=>{const l=e.filter(a=>a.kind==="videoinput");console.log(l),q(l)}),(async()=>await c.get("/sanctum/csrf-cookie"))()},[]);const C=async(e=null)=>{D(!0),g&&g.getTracks().forEach(n=>n.stop());const l={video:e?{deviceId:{exact:e}}:!0},a=await navigator.mediaDevices.getUserMedia(l);x.current.srcObject=a,A(a),v(!1),w(null),R(null)},O=()=>{g&&g.getTracks().forEach(e=>e.stop()),D(!1)},X=()=>{y.current.getContext("2d").drawImage(x.current,0,0,640,480),y.current.toBlob(K,"image/jpeg"),v(!0),O()},z=async()=>{if(m){r(!0),u("Deleting ...");try{const e=await c.delete("/api/delete-photo",{path:m},{headers:{Accept:"application/json"}});console.log(e==null?void 0:e.data),f("Photo enrolled successfully!")}catch(e){e.response&&e.response.status===422?h(e.response.data.errors||{}):console.error(e)}finally{i(!1),r(!1)}}w(null),v(!1),r(!1),C(p[b].deviceId)},B=async()=>{if(m){r(!0),u("Deleting ...");try{const e=await c.delete("/api/delete-photo",{path:m},{headers:{Accept:"application/json"}});console.log(e==null?void 0:e.data),f("Photo deleted successfully!")}catch(e){e.response&&e.response.status===422?h(e.response.data.errors||{}):console.error(e)}finally{i(!1),r(!1)}window.location.href=route("dashboard")}},H=async e=>{var l,a,n,E,$,F,M,T;if(e){u("Enrolling ...");try{const t=await c.post("/api/enroll-photo",{path:e},{headers:{Accept:"application/json"}});if(console.log(t==null?void 0:t.data),(a=(l=t==null?void 0:t.data)==null?void 0:l.output)!=null&&a.success&&((n=t==null?void 0:t.data)!=null&&n.record)){let d=(E=t==null?void 0:t.data)==null?void 0:E.record;u("Enrollment successful"),alert("Face enrolled successfully!"),f("Face enrolled successfully!"),setTimeout(()=>{window.location.href=route("records.edit",{id:d==null?void 0:d.id}),i(!1),r(!1)},4e3)}else{let d=((F=($=t==null?void 0:t.data)==null?void 0:$.output)==null?void 0:F.message)||"Photo enrollement failed!",S=((T=(M=t==null?void 0:t.data)==null?void 0:M.output)==null?void 0:T.status)||"";alert(`${S} ${d}`),u(`${S} ${d}`),f(`${S} ${d}`),setTimeout(()=>{i(!1),r(!1)},4e3)}}catch(t){t.response&&t.response.status===422?h(t.response.data.errors||{}):console.error(t)}finally{i(!1),r(!1)}}},K=async e=>{const l=new FormData;l.append("photo",e,"webcam.jpg"),r(!0),u("Processing ..."),i(!0),h({}),f("");try{const a=await c.post("/api/upload-photo",l,{headers:{"Content-Type":"multipart/form-data",Accept:"application/json"}}),n=a==null?void 0:a.data;w(n.url),R(n.path),console.log(n),await H(n.extpath),f("Photo uploaded successfully!")}catch(a){a.response&&a.response.status===422?h(a.response.data.errors||{}):console.error(a)}finally{i(!1)}},V=()=>{const e=(b+1)%p.length;L(e),C(p[e].deviceId)};return s.jsxs("div",{children:[s.jsx(W,{isVisible:I,message:U}),s.jsxs("div",{className:`${I?"hidden":"fixed"} z-50  inset-0 bg-gray-400 flex items-center justify-center`,children:[!j&&P&&s.jsx("video",{ref:x,autoPlay:!0,playsInline:!0,muted:!0,className:"w-full h-full object-cover"}),s.jsx("canvas",{ref:y,width:"640",height:"480",style:{display:"none"}}),!j&&s.jsx("div",{className:"absolute bottom-6 w-full flex justify-center gap-4 px-4",children:P?s.jsxs("div",{className:"flex gap-4",children:[s.jsx("button",{onClick:X,className:"bg-white text-blue-500 px-6 py-2 rounded shadow-lg text-lg",children:"Capture"}),p.length>1&&s.jsx("button",{onClick:V,className:"bg-gray-700 text-white px-6 py-2 rounded shadow text-lg",children:"Switch"}),s.jsx("a",{href:route("dashboard"),className:"bg-red-600 text-white px-6 py-2 rounded shadow-lg text-lg",children:"Close"})]}):s.jsxs(s.Fragment,{children:[s.jsx("button",{onClick:()=>{C(p[b].deviceId)},className:"bg-white text-black px-6 py-2 rounded shadow-lg text-lg",children:"Start Camera"}),s.jsx("a",{href:route("dashboard"),className:"bg-red-600 text-white px-6 py-2 rounded shadow-lg text-lg",children:"Close"})]})}),j&&s.jsxs("div",{className:"min-h-screen bg-gray-900 text-white flex flex-col items-center justify-center px-4 py-6",children:[N&&s.jsx("img",{src:N,alt:"Captured",className:"w-full max-w-md rounded-lg shadow-lg mb-6"}),s.jsxs("div",{className:"flex gap-3 justify-center",children:[s.jsx("button",{onClick:z,className:"bg-red-600 px-6 py-2 rounded shadow text-white text-lg",children:"Retake Photo"}),s.jsx("button",{onClick:B,className:"bg-red-600 px-6 py-2 rounded shadow text-white text-lg",children:"Close"})]})]})]})]})};export{_ as default};
