import{r as a,a as n,j as t}from"./app-NY-XNPcx.js";import O from"./OverlaySpinner-BYHWTwRk.js";n.defaults.headers.common["X-Requested-With"]="XMLHttpRequest";const C=document.head.querySelector('meta[name="csrf-token"]');console.log(C);C?n.defaults.headers.common["X-CSRF-TOKEN"]=C.content:console.error("CSRF token not found");n.defaults.withCredentials=!0;const B=()=>{const g=a.useRef(null),m=a.useRef(null),[S,x]=a.useState(null),[y,w]=a.useState(!1),[k,N]=a.useState(!1),[h,P]=a.useState(null),[R,l]=a.useState(!1),[D,p]=a.useState("Loading..."),[U,c]=a.useState(!1),[H,d]=a.useState({}),[K,i]=a.useState(""),[f,j]=a.useState(null),[u,I]=a.useState([]),[b,E]=a.useState(0);a.useEffect(()=>{navigator.mediaDevices.enumerateDevices().then(s=>{const o=s.filter(r=>r.kind==="videoinput");console.log(o),I(o)}),n.defaults.headers.common["X-Requested-With"]="XMLHttpRequest";const e=document.head.querySelector('meta[name="csrf-token"]');console.log(e),e?n.defaults.headers.common["X-CSRF-TOKEN"]=e.content:console.error("CSRF token not found"),n.defaults.withCredentials=!0,(async()=>await n.get("/sanctum/csrf-cookie"))()},[]);const v=async(e=null)=>{N(!0),h&&h.getTracks().forEach(r=>r.stop());const s={video:e?{deviceId:{exact:e}}:!0},o=await navigator.mediaDevices.getUserMedia(s);g.current.srcObject=o,P(o),w(!1),x(null),j(null)},q=()=>{h&&h.getTracks().forEach(e=>e.stop()),N(!1)},F=()=>{m.current.getContext("2d").drawImage(g.current,0,0,640,480),m.current.toBlob(T,"image/jpeg"),w(!0),q()},X=async()=>{if(f){l(!0),p("Deleting ...");try{const e=await n.delete("/api/delete-photo",{path:f},{headers:{Accept:"application/json"}});console.log(e==null?void 0:e.data),i("Photo enrolled successfully!")}catch(e){e.response&&e.response.status===422?d(e.response.data.errors||{}):console.error(e)}finally{c(!1),l(!1)}}x(null),j(null),w(!1),l(!1),v(u[b].deviceId)},A=async()=>{if(f){l(!0),p("Deleting ...");try{const e=await n.delete("/api/delete-photo",{path:f},{headers:{Accept:"application/json"}});console.log(e==null?void 0:e.data),i("Photo deleted successfully!")}catch(e){e.response&&e.response.status===422?d(e.response.data.errors||{}):console.error(e)}finally{c(!1),l(!1)}window.location.href=route("dashboard")}},M=async e=>{if(e){p("Enrolling ...");try{const s=await n.post("/api/enroll-photo",{path:e},{headers:{Accept:"application/json"}});console.log(s==null?void 0:s.data),i("Photo enrolled successfully!")}catch(s){s.response&&s.response.status===422?d(s.response.data.errors||{}):console.error(s)}finally{c(!1),l(!1)}}},T=async e=>{const s=new FormData;s.append("photo",e,"webcam.jpg"),l(!0),p("Processing ..."),c(!0),d({}),i("");try{const o=await n.post("/api/upload-photo",s,{headers:{"Content-Type":"multipart/form-data",Accept:"application/json"}}),r=o==null?void 0:o.data;x(r.url),j(r.path),console.log(r),await M(r.extpath),i("Photo uploaded successfully!")}catch(o){o.response&&o.response.status===422?d(o.response.data.errors||{}):console.error(o)}finally{c(!1)}},L=()=>{const e=(b+1)%u.length;E(e),v(u[e].deviceId)};return t.jsxs("div",{children:[t.jsx(O,{isVisible:R,message:D}),t.jsxs("div",{className:"fixed inset-0 bg-gray-400 z-50 flex items-center justify-center",children:[!y&&k&&t.jsx("video",{ref:g,autoPlay:!0,playsInline:!0,muted:!0,className:"w-full h-full object-cover"}),t.jsx("canvas",{ref:m,width:"640",height:"480",style:{display:"none"}}),!y&&t.jsx("div",{className:"absolute bottom-6 w-full flex justify-center gap-4 px-4",children:k?t.jsxs("div",{className:"flex gap-4",children:[t.jsx("button",{onClick:F,className:"bg-white text-blue-500 px-6 py-2 rounded shadow-lg text-lg",children:"Capture Photo"}),u.length>1&&t.jsx("button",{onClick:L,className:"bg-gray-700 text-white px-6 py-2 rounded shadow text-lg",children:"Switch Camera"}),t.jsx("a",{href:route("dashboard"),className:"bg-red-600 text-white px-6 py-2 rounded shadow-lg text-lg",children:"Close"})]}):t.jsxs(t.Fragment,{children:[t.jsx("button",{onClick:()=>{v(u[b].deviceId)},className:"bg-white text-black px-6 py-2 rounded shadow-lg text-lg",children:"Start Camera"}),t.jsx("a",{href:route("dashboard"),className:"bg-red-600 text-white px-6 py-2 rounded shadow-lg text-lg",children:"Close"})]})}),y&&t.jsxs("div",{className:"min-h-screen bg-gray-900 text-white flex flex-col items-center justify-center px-4 py-6",children:[S&&t.jsx("img",{src:S,alt:"Captured",className:"w-full max-w-md rounded-lg shadow-lg mb-6"}),t.jsxs("div",{className:"flex gap-3 justify-center",children:[t.jsx("button",{onClick:X,className:"bg-red-600 px-6 py-2 rounded shadow text-white text-lg",children:"Retake Photo"}),t.jsx("button",{className:"bg-white px-6 py-2 rounded shadow text-blue-500 text-lg",children:"Enroll"}),t.jsx("button",{onClick:A,className:"bg-red-600 px-6 py-2 rounded shadow text-white text-lg",children:"Close"})]})]})]})]})};export{B as default};
