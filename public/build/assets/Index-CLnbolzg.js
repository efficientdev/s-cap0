import{r as o,a as r,j as t}from"./app-Ckfq-X1x.js";import K from"./OverlaySpinner-CIc69o1P.js";r.defaults.headers.common["X-Requested-With"]="XMLHttpRequest";const k=document.head.querySelector('meta[name="csrf-token"]');console.log(k);k?r.defaults.headers.common["X-CSRF-TOKEN"]=k.content:console.error("CSRF token not found");r.defaults.withCredentials=!0;(async()=>await r.get("/sanctum/csrf-cookie"))();const G=()=>{const m=o.useRef(null),x=o.useRef(null),[N,y]=o.useState(null),[w,j]=o.useState(!1),[P,R]=o.useState(!1),[f,E]=o.useState(null),[D,c]=o.useState(!1),[q,p]=o.useState("Loading..."),[W,d]=o.useState(!1),[z,i]=o.useState({}),[B,u]=o.useState(""),[g,b]=o.useState(null),[h,A]=o.useState([]),[v,F]=o.useState(0);o.useEffect(()=>{navigator.mediaDevices.enumerateDevices().then(l=>{const s=l.filter(n=>n.kind==="videoinput");console.log(s),A(s)}),r.defaults.headers.common["X-Requested-With"]="XMLHttpRequest";const e=document.head.querySelector('meta[name="csrf-token"]');console.log(e),e?r.defaults.headers.common["X-CSRF-TOKEN"]=e.content:console.error("CSRF token not found"),r.defaults.withCredentials=!0,(async()=>await r.get("/sanctum/csrf-cookie"))()},[]);const C=async(e=null)=>{R(!0),f&&f.getTracks().forEach(n=>n.stop());const l={video:e?{deviceId:{exact:e}}:!0},s=await navigator.mediaDevices.getUserMedia(l);m.current.srcObject=s,E(s),j(!1),y(null),b(null)},X=()=>{f&&f.getTracks().forEach(e=>e.stop()),R(!1)},M=()=>{x.current.getContext("2d").drawImage(m.current,0,0,640,480),x.current.toBlob(U,"image/jpeg"),j(!0),X()},T=async()=>{if(g){c(!0),p("Deleting ...");try{const e=await r.delete("/api/delete-photo",{path:g},{headers:{Accept:"application/json"}});console.log(e==null?void 0:e.data),u("Photo enrolled successfully!")}catch(e){e.response&&e.response.status===422?i(e.response.data.errors||{}):console.error(e)}finally{d(!1),c(!1)}}y(null),b(null),j(!1),c(!1),C(h[v].deviceId)},L=async()=>{if(g){c(!0),p("Deleting ...");try{const e=await r.delete("/api/delete-photo",{path:g},{headers:{Accept:"application/json"}});console.log(e==null?void 0:e.data),u("Photo deleted successfully!")}catch(e){e.response&&e.response.status===422?i(e.response.data.errors||{}):console.error(e)}finally{d(!1),c(!1)}window.location.href=route("dashboard")}},O=async e=>{var l,s,n,I;if(e){p("Enrolling ...");try{const a=await r.post("/api/enroll-photo",{path:e},{headers:{Accept:"application/json"}});if(console.log(a==null?void 0:a.data),(s=(l=a==null?void 0:a.data)==null?void 0:l.output)!=null&&s.success&&((n=a==null?void 0:a.data)!=null&&n.record)){let S=(I=a==null?void 0:a.data)==null?void 0:I.record;window.location.href=route("records.edit",{id:S==null?void 0:S.id})}u("Photo enrolled successfully!")}catch(a){a.response&&a.response.status===422?i(a.response.data.errors||{}):console.error(a)}finally{d(!1),c(!1)}}},U=async e=>{const l=new FormData;l.append("photo",e,"webcam.jpg"),c(!0),p("Processing ..."),d(!0),i({}),u("");try{const s=await r.post("/api/upload-photo",l,{headers:{"Content-Type":"multipart/form-data",Accept:"application/json"}}),n=s==null?void 0:s.data;y(n.url),b(n.path),console.log(n),await O(n.extpath),u("Photo uploaded successfully!")}catch(s){s.response&&s.response.status===422?i(s.response.data.errors||{}):console.error(s)}finally{d(!1)}},H=()=>{const e=(v+1)%h.length;F(e),C(h[e].deviceId)};return t.jsxs("div",{children:[t.jsx(K,{isVisible:D,message:q}),t.jsxs("div",{className:`${D?"hidden":"fixed"} z-50  inset-0 bg-gray-400 flex items-center justify-center`,children:[!w&&P&&t.jsx("video",{ref:m,autoPlay:!0,playsInline:!0,muted:!0,className:"w-full h-full object-cover"}),t.jsx("canvas",{ref:x,width:"640",height:"480",style:{display:"none"}}),!w&&t.jsx("div",{className:"absolute bottom-6 w-full flex justify-center gap-4 px-4",children:P?t.jsxs("div",{className:"flex gap-4",children:[t.jsx("button",{onClick:M,className:"bg-white text-blue-500 px-6 py-2 rounded shadow-lg text-lg",children:"Capture Photo"}),h.length>1&&t.jsx("button",{onClick:H,className:"bg-gray-700 text-white px-6 py-2 rounded shadow text-lg",children:"Switch Camera"}),t.jsx("a",{href:route("dashboard"),className:"bg-red-600 text-white px-6 py-2 rounded shadow-lg text-lg",children:"Close"})]}):t.jsxs(t.Fragment,{children:[t.jsx("button",{onClick:()=>{C(h[v].deviceId)},className:"bg-white text-black px-6 py-2 rounded shadow-lg text-lg",children:"Start Camera"}),t.jsx("a",{href:route("dashboard"),className:"bg-red-600 text-white px-6 py-2 rounded shadow-lg text-lg",children:"Close"})]})}),w&&t.jsxs("div",{className:"min-h-screen bg-gray-900 text-white flex flex-col items-center justify-center px-4 py-6",children:[N&&t.jsx("img",{src:N,alt:"Captured",className:"w-full max-w-md rounded-lg shadow-lg mb-6"}),t.jsxs("div",{className:"flex gap-3 justify-center",children:[t.jsx("button",{onClick:T,className:"bg-red-600 px-6 py-2 rounded shadow text-white text-lg",children:"Retake Photo"}),t.jsx("button",{className:"bg-white px-6 py-2 rounded shadow text-blue-500 text-lg",children:"Add Details"}),t.jsx("button",{onClick:L,className:"bg-red-600 px-6 py-2 rounded shadow text-white text-lg",children:"Close"})]})]})]})]})};export{G as default};
