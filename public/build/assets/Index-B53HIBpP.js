import{r as s,a as n,j as e}from"./app-DQDRlbqj.js";n.defaults.headers.common["X-Requested-With"]="XMLHttpRequest";const j=document.head.querySelector('meta[name="csrf-token"]');console.log(j);j?n.defaults.headers.common["X-CSRF-TOKEN"]=j.content:console.error("CSRF token not found");n.defaults.withCredentials=!0;const K=()=>{const p=s.useRef(null),h=s.useRef(null),[b,f]=s.useState(null),[m,g]=s.useState(!1),[C,S]=s.useState(!1),[i,E]=s.useState(null),[X,r]=s.useState(!1),[A,d]=s.useState("Loading..."),[M,v]=s.useState(!1),[U,N]=s.useState({}),[J,k]=s.useState(""),[u,x]=s.useState(null),[c,R]=s.useState([]),[y,D]=s.useState(0);s.useEffect(()=>{navigator.mediaDevices.enumerateDevices().then(l=>{const a=l.filter(o=>o.kind==="videoinput");console.log(a),R(a)}),n.defaults.headers.common["X-Requested-With"]="XMLHttpRequest";const t=document.head.querySelector('meta[name="csrf-token"]');console.log(t),t?n.defaults.headers.common["X-CSRF-TOKEN"]=t.content:console.error("CSRF token not found"),n.defaults.withCredentials=!0,(async()=>await n.get("/sanctum/csrf-cookie"))()},[]);const w=async(t=null)=>{S(!0),i&&i.getTracks().forEach(o=>o.stop());const l={video:t?{deviceId:{exact:t}}:!0},a=await navigator.mediaDevices.getUserMedia(l);p.current.srcObject=a,E(a),g(!1),f(null),x(null)},P=()=>{i&&i.getTracks().forEach(t=>t.stop()),S(!1)},I=()=>{h.current.getContext("2d").drawImage(p.current,0,0,640,480),h.current.toBlob(F,"image/jpeg"),g(!0),P()},T=async()=>{u&&(r(!0),d("Deleting ..."),await fetch("/api/delete-photo",{method:"DELETE",headers:{"Content-Type":"application/json",Accept:"application/json"},body:JSON.stringify({path:u})})),f(null),x(null),g(!1),r(!1),w(c[y].deviceId)},O=async()=>{u&&(r(!0),d("Deleting ..."),await fetch("/api/delete-photo",{method:"DELETE",headers:{"Content-Type":"application/json",Accept:"application/json"},body:JSON.stringify({path:u})}),r(!1),window.location.href=route("dashboard"))},q=async t=>{t&&(d("Enrolling ..."),await fetch("/api/enroll-photo",{method:"POST",headers:{"Content-Type":"application/json",Accept:"application/json"},body:JSON.stringify({path:t})}),r(!1))},F=async t=>{const l=new FormData;l.append("photo",t,"webcam.jpg"),r(!0),d("Processing ..."),v(!0),N({}),k("");try{const o=await n.post("/api/upload-photo",l,{headers:{"Content-Type":"multipart/form-data",Accept:"application/json"}});k("Photo uploaded successfully!")}catch(o){o.response&&o.response.status===422?N(o.response.data.errors||{}):console.error(o)}finally{v(!1)}const a=await response.json();f(a.url),x(a.path),console.log(a),await q(a.extpath)},L=()=>{const t=(y+1)%c.length;D(t),w(c[t].deviceId)};return e.jsx("div",{children:e.jsxs("div",{className:"fixed inset-0 bg-gray-400 z-50 flex items-center justify-center",children:[!m&&C&&e.jsx("video",{ref:p,autoPlay:!0,playsInline:!0,muted:!0,className:"w-full h-full object-cover"}),e.jsx("canvas",{ref:h,width:"640",height:"480",style:{display:"none"}}),!m&&e.jsx("div",{className:"absolute bottom-6 w-full flex justify-center gap-4 px-4",children:C?e.jsxs("div",{className:"flex gap-4",children:[e.jsx("button",{onClick:I,className:"bg-white text-blue-500 px-6 py-2 rounded shadow-lg text-lg",children:"Capture Photo"}),c.length>1&&e.jsx("button",{onClick:L,className:"bg-gray-700 text-white px-6 py-2 rounded shadow text-lg",children:"Switch Camera"}),e.jsx("a",{href:route("dashboard"),className:"bg-red-600 text-white px-6 py-2 rounded shadow-lg text-lg",children:"Close"})]}):e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:()=>{w(c[y].deviceId)},className:"bg-white text-black px-6 py-2 rounded shadow-lg text-lg",children:"Start Camera"}),e.jsx("a",{href:route("dashboard"),className:"bg-red-600 text-white px-6 py-2 rounded shadow-lg text-lg",children:"Close"})]})}),m&&e.jsxs("div",{className:"min-h-screen bg-gray-900 text-white flex flex-col items-center justify-center px-4 py-6",children:[b&&e.jsx("img",{src:b,alt:"Captured",className:"w-full max-w-md rounded-lg shadow-lg mb-6"}),e.jsxs("div",{className:"flex gap-3 justify-center",children:[e.jsx("button",{onClick:T,className:"bg-red-600 px-6 py-2 rounded shadow text-white text-lg",children:"Retake Photo"}),e.jsx("button",{className:"bg-white px-6 py-2 rounded shadow text-blue-500 text-lg",children:"Enroll"}),e.jsx("button",{onClick:O,className:"bg-red-600 px-6 py-2 rounded shadow text-white text-lg",children:"Close"})]})]})]})})};export{K as default};
